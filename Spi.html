<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SPI語句メモアプリ</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    padding: 16px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #f5f5f5;
  }
  h1 {
    margin-top: 0;
    font-size: 1.4rem;
  }
  .container {
    display: grid;
    gap: 16px;
  }
  @media (min-width: 900px) {
    .container {
      grid-template-columns: 1.1fr 1.4fr;
      align-items: flex-start;
    }
  }
  section {
    background: #fff;
    padding: 12px 16px 16px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,.06);
  }
  section h2 {
    margin-top: 0;
    font-size: 1.1rem;
    border-left: 4px solid #007acc;
    padding-left: 8px;
  }
  label {
    display: block;
    margin: 4px 0 2px;
    font-size: .85rem;
    font-weight: 600;
  }
  input[type="text"],
  textarea,
  select {
    width: 100%;
    padding: 6px 8px;
    margin-bottom: 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: .9rem;
  }
  textarea {
    resize: vertical;
    min-height: 60px;
  }
  .small {
    font-size: .8rem;
    color: #555;
  }
  button {
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: .9rem;
  }
  .btn-primary {
    background: #007acc;
    color: #fff;
  }
  .btn-secondary {
    background: #eee;
    color: #333;
  }
  .chip-group {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-bottom: 8px;
  }
  .chip {
    font-size: .75rem;
    padding: 3px 6px;
    border-radius: 999px;
    border: 1px solid #bbb;
    background: #fafafa;
    cursor: pointer;
    user-select: none;
  }
  .chip.selected {
    background: #007acc;
    color: #fff;
    border-color: #007acc;
  }
  .result-count {
    font-size: .8rem;
    color: #555;
    margin-bottom: 8px;
  }
  .card {
    border-radius: 6px;
    border: 1px solid #ddd;
    padding: 8px 10px;
    margin-bottom: 8px;
    background: #fff;
  }
  .card-header {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    align-items: baseline;
  }
  .word {
    font-weight: 700;
    font-size: 1rem;
  }
  .reading {
    font-size: .8rem;
    color: #666;
  }
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-top: 4px;
  }
  .tag {
    font-size: .7rem;
    padding: 2px 4px;
    border-radius: 4px;
    background: #e0f2ff;
    color: #005799;
  }
  .meta {
    font-size: .8rem;
    margin-top: 4px;
  }
  .meta span {
    font-weight: 600;
  }
  .notes {
    font-size: .8rem;
    margin-top: 4px;
    color: #444;
  }
  .card-footer {
    margin-top: 6px;
    text-align: right;
  }
  .card-footer button {
    font-size: .75rem;
    padding: 4px 6px;
  }
  .search-row {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
  }
  .search-row input[type="text"] {
    flex: 1;
    margin-bottom: 0;
  }
</style>
</head>
<body>
  <h1>SPI語句メモアプリ（自作辞書）</h1>
  <div class="container">
    <!-- 登録フォーム -->
    <section>
      <h2>単語を登録</h2>
      <form id="entry-form">
        <label>単語・熟語</label>
        <input type="text" id="word" required placeholder="例: 神妙" />

        <label>よみ</label>
        <input type="text" id="reading" placeholder="例: しんみょう" />

        <label>意味</label>
        <textarea id="meaning" required placeholder="例: おとなしく素直なさま"></textarea>

        <label>分野タグ（複数可）</label>
        <div id="category-chips" class="chip-group"></div>
        <div class="small">例: 類義語 / 対義語 / 包含 / 四字熟語 / 接続語 / 敬語 / 文法 / 長文…</div>

        <label>２語の関係（複数可）</label>
        <div id="relation-chips" class="chip-group"></div>

        <label>類義語（カンマ区切り）</label>
        <input type="text" id="synonyms" placeholder="例: おとなしい, 素直" />

        <label>対義語（カンマ区切り）</label>
        <input type="text" id="antonyms" placeholder="例: 不遜, 横柄" />

        <label>メモ</label>
        <textarea id="notes" placeholder="例: SPI語句問題で頻出。『神妙な面持ち』など。"></textarea>

        <button type="submit" class="btn-primary">登録 / 更新</button>
        <button type="button" id="cancel-edit" class="btn-secondary">キャンセル</button>
        <div class="small" id="edit-status"></div>
      </form>
    </section>

    <!-- 検索＆一覧 -->
    <section>
      <h2>検索 / 一覧</h2>
      <div class="search-row">
        <input type="text" id="search" placeholder="単語・意味・類義語などで検索" />
        <button type="button" id="clear-search" class="btn-secondary">クリア</button>
      </div>
      <div class="result-count" id="result-count"></div>
      <div id="result-list"></div>
    </section>
  </div>

<script>
  const STORAGE_KEY = "spi_vocab_v1";

  // デフォルトで用意しておくタグ
  const CATEGORY_PRESET = [
    "類義語", "対義語", "包含",
    "四字熟語", "語句の意味",
    "長文読解", "文字並べ",
    "接続語", "敬語", "文法"
  ];
  const RELATION_PRESET = ["類義語", "対義語", "包含"];

  let entries = [];
  let editingId = null;

  function loadEntries() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) {
      entries = [];
      return;
    }
    try {
      entries = JSON.parse(raw) || [];
    } catch (e) {
      console.error("JSON parse error", e);
      entries = [];
    }
  }

  function saveEntries() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
  }

  function createChips(containerId, items) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    items.forEach(text => {
      const span = document.createElement("span");
      span.className = "chip";
      span.textContent = text;
      span.dataset.value = text;
      span.addEventListener("click", () => {
        span.classList.toggle("selected");
      });
      container.appendChild(span);
    });
  }

  function getSelectedChips(containerId) {
    const container = document.getElementById(containerId);
    const selected = container.querySelectorAll(".chip.selected");
    return Array.from(selected).map(chip => chip.dataset.value);
  }

  function clearSelectedChips(containerId) {
    const container = document.getElementById(containerId);
    const chips = container.querySelectorAll(".chip.selected");
    chips.forEach(chip => chip.classList.remove("selected"));
  }

  function setSelectedChips(containerId, values) {
    const container = document.getElementById(containerId);
    const chips = container.querySelectorAll(".chip");
    chips.forEach(chip => {
      if (values.includes(chip.dataset.value)) {
        chip.classList.add("selected");
      } else {
        chip.classList.remove("selected");
      }
    });
  }

  function renderList() {
    const list = document.getElementById("result-list");
    const countEl = document.getElementById("result-count");
    const q = document.getElementById("search").value.trim();

    let filtered = entries;
    if (q) {
      const lower = q.toLowerCase();
      filtered = entries.filter(e => {
        const allText = [
          e.word,
          e.reading,
          e.meaning,
          (e.synonyms || []).join(" "),
          (e.antonyms || []).join(" "),
          (e.notes || "")
        ].join(" ").toLowerCase();
        return allText.includes(lower);
      });
    }

    countEl.textContent = `登録数：${entries.length}件 / 検索結果：${filtered.length}件`;

    if (!filtered.length) {
      list.innerHTML = "<div class='small'>まだ登録がありません。</div>";
      return;
    }

    // 新しい順に並べたいので id(=timestamp) で降順ソート
    filtered.sort((a, b) => b.id - a.id);

    list.innerHTML = "";
    filtered.forEach(e => {
      const card = document.createElement("div");
      card.className = "card";

      const header = document.createElement("div");
      header.className = "card-header";

      const left = document.createElement("div");
      left.innerHTML = `
        <div class="word">${e.word}</div>
        <div class="reading">${e.reading || ""}</div>
      `;

      const right = document.createElement("div");
      right.className = "tags";
      (e.category || []).forEach(t => {
        const span = document.createElement("span");
        span.className = "tag";
        span.textContent = t;
        right.appendChild(span);
      });

      header.appendChild(left);
      header.appendChild(right);

      const meaning = document.createElement("div");
      meaning.className = "meta";
      meaning.innerHTML = `<span>意味：</span>${(e.meaning || "").replace(/\n/g, "<br>")}`;

      const relation = document.createElement("div");
      relation.className = "meta";
      const relText = (e.relationType || []).join("・") || "―";
      relation.innerHTML = `<span>関係：</span>${relText}`;

      const syn = document.createElement("div");
      syn.className = "meta";
      syn.innerHTML = `<span>類義語：</span>${(e.synonyms || []).join(" / ") || "―"}`;

      const ant = document.createElement("div");
      ant.className = "meta";
      ant.innerHTML = `<span>対義語：</span>${(e.antonyms || []).join(" / ") || "―"}`;

      const notes = document.createElement("div");
      notes.className = "notes";
      notes.textContent = e.notes || "";

      const footer = document.createElement("div");
      footer.className = "card-footer";

      const editBtn = document.createElement("button");
      editBtn.className = "btn-secondary";
      editBtn.textContent = "編集";
      editBtn.addEventListener("click", () => startEdit(e.id));

      const delBtn = document.createElement("button");
      delBtn.className = "btn-secondary";
      delBtn.textContent = "削除";
      delBtn.style.marginLeft = "4px";
      delBtn.addEventListener("click", () => {
        if (confirm(`「${e.word}」を削除しますか？`)) {
          entries = entries.filter(x => x.id !== e.id);
          saveEntries();
          renderList();
        }
      });

      footer.appendChild(editBtn);
      footer.appendChild(delBtn);

      card.appendChild(header);
      card.appendChild(meaning);
      card.appendChild(relation);
      card.appendChild(syn);
      card.appendChild(ant);
      if (e.notes) card.appendChild(notes);
      card.appendChild(footer);

      list.appendChild(card);
    });
  }

  function startEdit(id) {
    const entry = entries.find(e => e.id === id);
    if (!entry) return;

    editingId = id;
    document.getElementById("word").value = entry.word || "";
    document.getElementById("reading").value = entry.reading || "";
    document.getElementById("meaning").value = entry.meaning || "";
    document.getElementById("synonyms").value = (entry.synonyms || []).join(", ");
    document.getElementById("antonyms").value = (entry.antonyms || []).join(", ");
    document.getElementById("notes").value = entry.notes || "";
    setSelectedChips("category-chips", entry.category || []);
    setSelectedChips("relation-chips", entry.relationType || []);
    document.getElementById("edit-status").textContent = `編集モード：${entry.word}`;
  }

  function clearForm() {
    editingId = null;
    document.getElementById("entry-form").reset();
    clearSelectedChips("category-chips");
    clearSelectedChips("relation-chips");
    document.getElementById("edit-status").textContent = "";
  }

  function init() {
    createChips("category-chips", CATEGORY_PRESET);
    createChips("relation-chips", RELATION_PRESET);

    loadEntries();
    renderList();

    document.getElementById("entry-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const word = document.getElementById("word").value.trim();
      const reading = document.getElementById("reading").value.trim();
      const meaning = document.getElementById("meaning").value.trim();
      const synonymsRaw = document.getElementById("synonyms").value.trim();
      const antonymsRaw = document.getElementById("antonyms").value.trim();
      const notes = document.getElementById("notes").value.trim();
      const category = getSelectedChips("category-chips");
      const relationType = getSelectedChips("relation-chips");

      if (!word || !meaning) {
        alert("『単語・熟語』と『意味』は必須です。");
        return;
      }

      const synonyms = synonymsRaw
        ? synonymsRaw.split(",").map(s => s.trim()).filter(Boolean)
        : [];
      const antonyms = antonymsRaw
        ? antonymsRaw.split(",").map(s => s.trim()).filter(Boolean)
        : [];

      if (editingId) {
        // 更新
        const idx = entries.findIndex(e => e.id === editingId);
        if (idx !== -1) {
          entries[idx] = {
            ...entries[idx],
            word,
            reading,
            meaning,
            synonyms,
            antonyms,
            notes,
            category,
            relationType
          };
        }
      } else {
        // 新規追加
        const entry = {
          id: Date.now(),
          word,
          reading,
          meaning,
          synonyms,
          antonyms,
          notes,
          category,
          relationType
        };
        entries.push(entry);
      }

      saveEntries();
      clearForm();
      renderList();
    });

    document.getElementById("cancel-edit").addEventListener("click", () => {
      clearForm();
    });

    document.getElementById("search").addEventListener("input", () => {
      renderList();
    });

    document.getElementById("clear-search").addEventListener("click", () => {
      document.getElementById("search").value = "";
      renderList();
    });
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
